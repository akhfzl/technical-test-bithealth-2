# Technical Test â€” Modular FastAPI + LangGraph + Qdrant

Repository ini berisi implementasi backend berbasis **FastAPI**, **LangGraph**, dan **Qdrant**, dengan penerapan modularitas, konfigurasi environment, serta pengujian menggunakan **pytest**. Seluruh kode telah dirapikan dengan prinsip clean architecture dan keterpisahan komponen.

---

## ğŸš€ 1. Environment & Installation

Project ini menggunakan:

- **Python v3.11.6**
- Dependency diatur melalui `requirements.txt`

### Instalasi

```bash
python3.11 -m venv myenv
source myenv/bin/activate       # Linux / Mac
myenv\Scripts\activate          # Windows

pip install -r requirements.txt
```

---

## ğŸ“ 2. Struktur Modular Project

Repository ini menerapkan struktur modular agar project mudah dirawat, diuji, dan diperluas.

```
app/
â”‚
â”œâ”€â”€ api/            # Routing FastAPI
â”œâ”€â”€ services/       # Service layer (embedding, workflow, qdrant)
â”œâ”€â”€ repositories/   # Data access abstraction layer
â”œâ”€â”€ workflows/      # LangGraph workflow
â”œâ”€â”€ schemas/        # Pydantic models
â”œâ”€â”€ core/           # Dependency Injection, startup
â””â”€â”€ config/         # Settings (.env)
```

Kelebihan pendekatan ini:

- Memisahkan business logic dari API
- Memudahkan unit testing
- Memudahkan dependency injection
- Mengurangi tight coupling antar komponen

---

## ğŸ” 3. Environment Variables (.env)

Credential dan konfigurasi tidak disimpan di kode melainkan pada file:

- `.env` (asli)
- `.env-example` (template yang aman untuk dishare)

Contoh `.env-example`:

```
QDRANT_URL=your-qdrant-url
QDRANT_API_KEY=your-api-key
QDRANT_COLLECTION=messy_documents
EMBED_DIM=384
```

Semua environment di-load otomatis melalui `pydantic-settings`.

---

## ğŸ§© 4. Kendala & Temuan Teknis

Selama pengembangan, ditemukan berbagai masalah terkait integrasi:

### â—¼ 4.1 API Qdrant Deprecation & Parameter Changes

Banyak method lama Qdrant yang **deprecated**, antara lain:

- `.search()` sudah tidak digunakan
- `.search` diganti menjadi `.query_points()`
- Parameter seperti `vector`, `query_vector`, `vectors`, `query_filter` sudah berubah format
- Pemanggilan Qdrant Cloud harus menggunakan `url=` bukan `host=` atau `port=`

Contoh yang benar:

```python
qdrant.query_points(
    collection_name="documents",
    query=[0.1, 0.2, 0.3],
    limit=5
)
```

### â—¼ 4.2 Parameter Salah Sasaran

Beberapa error yang ditemukan:

- `"Unknown arguments: ['query_vector']"`
- `"Unknown arguments: ['vector']"`
- `"Unsupported query type: <class 'dict'>"`

Semua diselesaikan dengan menyesuaikan signature API Qdrant terbaru.

---

## ğŸ§± 5. Penyesuaian Pydantic (v2.x)

Banyak model Pydantic perlu disesuaikan karena:

- `BaseSettings` pindah ke `pydantic-settings`
- `Union[...]` tidak boleh di-instansiasi sebagai tipe response
- Harus menggunakan `Optional[T]` atau `T | None`

Contoh model final:

```python
class WorkflowResult(BaseModel):
    initial_query: str
    retrieved_docs: List[DocumentSchema]
    final_answer: str
    processing_time: float
```

Model dibuat agar kompatibel dengan FastAPI + Pydantic v2.

---

## ğŸ§ª 6. Testing Menggunakan pytest

Pengujian dilakukan dengan **pytest**, mencakup:

### âœ” Unit Test

- Menguji workflow
- Menguji embedder
- Menguji Qdrant service dengan mock

### âœ” Integration Test

- Menguji endpoint FastAPI (`/query`, `/ingest`) menggunakan TestClient
- Menggunakan dependency override agar tidak perlu koneksi Qdrant

### Menjalankan test:

```bash
pytest -v
```

Struktur test:

```
tests/
â”‚
â”œâ”€â”€ unit/
â”œâ”€â”€ integration/
â””â”€â”€ conftest.py
```

Dengan mocking, semua test dapat dijalankan **tanpa koneksi internet** dan **tanpa Qdrant Cloud**.

---

## ğŸ“Œ Ringkasan

| Fitur                                           | Status    |
| ----------------------------------------------- | --------- |
| Modularisasi project                            | âœ” Selesai |
| Environment config (.env)                       | âœ” Selesai |
| Penyesuaian Pydantic v2                         | âœ” Selesai |
| Perbaikan Qdrant API terbaru                    | âœ” Selesai |
| Unit test + Integration test menggunakan pytest | âœ” Selesai |
| Mocking dependencies                            | âœ” Selesai |

---

## ğŸ‰ Penutup

Project ini memperlihatkan implementasi arsitektur Python modern yang scalable, testable, dan production-ready.
Fokus utama mencakup modularitas, pemisahan service layer, integrasi ke Qdrant, workflow AI (LangGraph), dan testability.

Silakan gunakan, modifikasi, dan kembangkan sesuai kebutuhan.
